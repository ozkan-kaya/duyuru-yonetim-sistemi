<div class="mb-4">
  <div class="level is-mobile mb-3">
    <div class="level-left">
      <div class="level-item">
        <h3 class="title is-4 mb-0">Duyurular</h3>
      </div>
    </div>

    <div class="level-right">
      <div class="level-item">
        <input class="input" type="text" placeholder="Ara..." style="min-width: 250px;" [ngModel]="searchText()"
          (ngModelChange)="searchText.set($event)" />
      </div>

      <div class="level-item">
        <div class="select">
          <select #sortSelect (change)="
              sortField.set(sortSelect.value.split('-')[0]);
              sortDir.set(sortSelect.value.split('-')[1])
            ">
            <option value="tarih-desc">Tarih: Yeni → Eski</option>
            <option value="tarih-asc">Tarih: Eski → Yeni</option>
            <option value="oncelik-desc">Öncelik: Yüksek → Düşük</option>
            <option value="oncelik-asc">Öncelik: Düşük → Yüksek</option>
          </select>
        </div>
      </div>

      <!-- Filtreler -->
      <div class="level-item">
        <button class="button" (click)="toggleFilters()">
          <span class="icon">
            <i class="fas fa-filter"></i>
          </span>
          <span>Filtreler</span>
          <span class="icon">
            <i class="fas" [class.fa-chevron-right]="!showFilters()" [class.fa-chevron-down]="showFilters()"></i>
          </span>
        </button>
      </div>
    </div>
  </div>

  @if (showFilters()) {
  <div class="box">
    <div class="is-flex is-justify-content-space-between is-align-items-center mb-3">
      <h5 class="title is-6 mb-0">Filtreler</h5>
      <button class="button" (click)="clearFilters()">
        <span class="icon">
          <i class="fas fa-times-circle"></i>
        </span>
        <span>Filtreleri Temizle</span>
      </button>
    </div>

    <div class="columns">
      <div class="column">
        <label class="label">Öncelik</label>
        <div class="select is-fullwidth">
          <select [ngModel]="oncelikFilter()" (ngModelChange)="oncelikFilter.set($event)">
            <option [ngValue]="null">Tümü</option>
            <option [ngValue]="1">Düşük</option>
            <option [ngValue]="2">Orta</option>
            <option [ngValue]="3">Yüksek</option>
          </select>
        </div>
      </div>

      <div class="column">
        <label class="label">Departman</label>
        <div class="select is-fullwidth">
          <select [ngModel]="departmanFilter()" (ngModelChange)="departmanFilter.set($event)">
            <option [ngValue]="null">Tümü</option>
            @for (dept of departmanlar; track dept.id) {
            <option [ngValue]="dept.id">{{ dept.name }}</option>
            }
          </select>
        </div>
      </div>

      <div class="column is-half">
        <label class="label">Tarih Aralığı</label>
        <div class="field has-addons">
          <div class="control is-expanded">
            <input class="input" type="date" [ngModel]="tarihStart()" (ngModelChange)="tarihStart.set($event)" />
          </div>
          <div class="control">
            <span class="button is-static">-</span>
          </div>
          <div class="control is-expanded">
            <input class="input" type="date" [ngModel]="tarihEnd()" (ngModelChange)="tarihEnd.set($event)" />
          </div>
        </div>
      </div>
    </div>
  </div>
  }
</div>

<div class="duyuru-grid">
  @for (duyuru of paginatedDuyurular(); track duyuru.id) {
  <div class="duyuru-grid-item">
    <app-duyuru-card [duyuru]="duyuru" [totalDepartments]="totalDepartments()"
      (cardClick)="onDuyuruClick($event)"></app-duyuru-card>
  </div>
  }
</div>

<!-- Pagination -->
@if (filteredDuyurular().length > 0) {
<nav class="pagination is-centered mt-6" role="navigation" aria-label="pagination">

  <button class="pagination-previous" [disabled]="currentPage() === 1" (click)="prevPage()">
    <span class="icon">
      <i class="fas fa-chevron-left"></i>
    </span>
  </button>

  <button class="pagination-next" [disabled]="currentPage() === totalPages()" (click)="nextPage()">
    <span class="icon">
      <i class="fas fa-chevron-right"></i>
    </span>
  </button>

  <ul class="pagination-list">
    @for (page of pages(); let idx = $index; track idx) {
    <li>
      <button class="pagination-link" [class.is-current]="currentPage() === (idx + 1)"
        (click)="currentPage.set(idx + 1)">
        {{ idx + 1 }}
      </button>
    </li>
    }
  </ul>

</nav>
}

<!-- Modal -->
<app-duyuru-modal [duyuru]="selectedDuyuru()" [isActive]="isModalActive()"
  (modalClose)="closeModal()"></app-duyuru-modal>