<section class="section">
  <div class="container">

    <h1 class="title is-2">Profil</h1>
    <hr>

    <div>
      <h1 class="title is-4">Kullanıcı Bilgileri</h1>
      @if (currentUser) {
      <div class="box">
        <div class="field">
          <label class="label">İsim</label>
          <div class="control">
            <input class="input" type="text" [value]="currentUser.isim" readonly>
          </div>
        </div>
        <div class="field">
          <label class="label">Sicil Numarası</label>
          <div class="control">
            <input class="input" type="text" [value]="currentUser.sicil" readonly>
          </div>
        </div>
        <div class="field">
          <label class="label">Rol</label>
          <div class="control">
            <input class="input" type="text" [value]="currentUser.rol" readonly>
          </div>
        </div>
      </div>
      } @else {
      <p>Kullanıcı bilgileri yükleniyor...</p>
      }
    </div>

    <hr>

    <!-- Arama ve Sıralama -->
    <div class="level is-mobile mb-4">
      <div class="level-left">
        <div class="level-item">
          <h1 class="title is-4 mb-0">Duyuru Okuma Aktivitesi</h1>
        </div>
      </div>
      <div class="level-right">
        <div class="level-item">
          <div class="field has-addons">
            <p class="control">
              <input class="input" type="text" placeholder="Ara..." [(ngModel)]="searchQuery"
                (ngModelChange)="onSearchChange($event)" style="min-width: 250px">
            </p>
          </div>
        </div>
        <div class="level-item">
          <div class="select">
            <select [(ngModel)]="sortOrder" (change)="onSortChange()">
              <option value="read-new-to-old">Okunmaya Göre (Yeni → Eski)</option>
              <option value="read-old-to-new">Okunmaya Göre (Eski → Yeni)</option>
              <option value="date-new-to-old">Tarihe Göre (Yeni → Eski)</option>
              <option value="date-old-to-new">Tarihe Göre (Eski → Yeni)</option>
              <option value="priority-high-low">Önceliğe Göre (Yüksek → Düşük)</option>
              <option value="priority-low-high">Önceliğe Göre (Düşük → Yüksek)</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <div class="box">
      <div class="table-container">
        <table class="table is-fullwidth is-striped is-hoverable">
          <thead>
            <tr>
              <th style="width: 35%">Duyuru Başlığı</th>
              <th style="width: 20%">Öncelik</th>
              <th style="width: 20%">Başlangıç</th>
              <th style="width: 20%">Bitiş</th>
              <th style="width: 25%">Okunma Tarihi</th>
            </tr>
          </thead>
          <tbody>
            @for (aktivite of filteredAktiviteler; track aktivite.id) {
            <tr class="is-clickable" (click)="openModal(aktivite)">
              <td>
                <strong>{{ aktivite.baslik }}</strong>
              </td>
              <td>
                <span class="tag" [class.is-danger]="aktivite.oncelik === 3" [class.is-warning]="aktivite.oncelik === 2"
                  [class.is-info]="aktivite.oncelik === 1">
                  {{ aktivite.oncelik === 3 ? 'Yüksek' : aktivite.oncelik === 2 ? 'Orta' : 'Düşük' }}
                </span>
              </td>
              <td>{{ aktivite.duyuru_baslangic_tarihi | date: 'dd.MM.yyyy' }}</td>
              <td>{{ aktivite.duyuru_bitis_tarihi ? (aktivite.duyuru_bitis_tarihi | date: 'dd.MM.yyyy') : 'Süresiz' }}
              </td>
              <td>{{ aktivite.okunma_tarihi | date: 'dd.MM.yyyy' }}</td>
            </tr>
            } @empty {
            <tr>
              <td colspan="5" class="has-text-centered has-text-grey">
                @if (searchQuery.trim().length >= 2) {
                <div class="py-4">
                  <span class="icon is-large">
                    <i class="fas fa-search fa-2x"></i>
                  </span>
                  <p class="mt-2">Arama sonucu bulunamadı.</p>
                </div>
                } @else {
                <div class="py-4">
                  <span class="icon is-large">
                    <i class="fas fa-inbox fa-2x"></i>
                  </span>
                  <p class="mt-2">Henüz hiç duyuru okumadınız.</p>
                </div>
                }
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>

  </div>
</section>

<!-- Modal -->
<app-duyuru-modal [duyuru]="selectedDuyuru" [isActive]="isModalActive" (modalClose)="closeModal()"></app-duyuru-modal>